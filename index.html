<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso Restrito - Procedimentos Técnicos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <style>
        body, html {
            margin: 0; padding: 0; height: 100%;
            background-color: #333; font-family: sans-serif;
            display: flex; flex-direction: column; align-items: center;
        }
        #viewer-container {
            flex-grow: 1; overflow: auto; width: 100%;
            text-align: center; padding: 20px 0; box-sizing: border-box;
        }
        #pdf-canvas {
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        #controls {
            padding: 10px; background-color: #2c3e50; width: 100%;
            text-align: center; box-sizing: border-box; position: sticky;
            bottom: 0; display: flex; justify-content: center;
            align-items: center; gap: 15px;
        }
        #controls button {
            width: 40px; height: 40px; font-size: 24px;
            font-weight: bold; cursor: pointer; border-radius: 50%;
            border: none; background-color: #ecf0f1; color: #2c3e50;
        }
        #page-info {
            color: white; font-size: 16px; min-width: 120px;
        }
        /* Oculta o conteúdo até a senha ser inserida */
        .hidden-content { display: none; }
    </style>
</head>
<body>

    <div id="content" class="hidden-content" style="display: contents;">
        <div id="viewer-container">
            <canvas id="pdf-canvas"></canvas>
        </div>

        <div id="controls">
            <button id="prev-page" title="Página Anterior">&lt;</button>
            <span id="page-info">Pág. <span id="page-num">0</span> / <span id="page-count">0</span></span>
            <button id="next-page" title="Próxima Página">&gt;</button>
            <div style="width: 2px; height: 30px; background-color: #555; margin: 0 10px;"></div>
            <button id="zoom-out" title="Diminuir Zoom">-</button>
            <button id="zoom-in" title="Aumentar Zoom">+</button>
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÕES DE SEGURANÇA ---
        const CORRECT_PASSWORD = 'supply321';
        const WATERMARK_TEXT = 'USO INTERNO - SUPPLY MARINE';
        const PDF_URL = 'https://raw.githubusercontent.com/chiesa2k/supplymarineprocedimentoshvac/main/SUPPLYMARINE_ProcedimentosTecnicoHVACR_vs03.pdf';

        // --- LÓGICA DE SENHA ---
        function checkPassword() {
            const password = prompt("Por favor, insira a senha para acessar o documento:", "");
            if (password === CORRECT_PASSWORD) {
                document.getElementById('content').style.display = 'contents';
                initializePDFViewer();
            } else if (password !== null) {
                alert("Senha incorreta.");
                checkPassword();
            } else {
                 document.body.innerHTML = '<h1 style="color:white; text-align:center; margin-top: 50px;">Acesso cancelado.</h1>';
            }
        }

        // --- INICIALIZAÇÃO DO VISUALIZADOR DE PDF ---
        function initializePDFViewer() {
            const { pdfjsLib } = window;
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js';

            let pdfDoc = null, pageNum = 1, currentScale = 1.0, isFirstRender = true;

            const canvas = document.getElementById('pdf-canvas'),
                  ctx = canvas.getContext('2d'),
                  viewerContainer = document.getElementById('viewer-container'),
                  pageNumSpan = document.getElementById('page-num'),
                  pageCountSpan = document.getElementById('page-count');
            
            const renderPage = num => {
                pdfDoc.getPage(num).then(page => {
                    const devicePixelRatio = window.devicePixelRatio || 1;
                    const viewport = page.getViewport({ scale: 1.0 });

                    // Ajusta a escala inicial à largura da tela na primeira vez
                    if (isFirstRender) {
                        currentScale = (viewerContainer.clientWidth - 40) / viewport.width;
                        isFirstRender = false;
                    }
                    
                    const scaledViewport = page.getViewport({ scale: currentScale * devicePixelRatio });
                    
                    canvas.height = scaledViewport.height;
                    canvas.width = scaledViewport.width;
                    canvas.style.height = `${scaledViewport.height / devicePixelRatio}px`;
                    canvas.style.width = `${scaledViewport.width / devicePixelRatio}px`;

                    const renderContext = {
                        canvasContext: ctx,
                        viewport: scaledViewport
                    };
                    page.render(renderContext).promise.then(() => {
                        // --- APLICAÇÃO DA MARCA D'ÁGUA ---
                        ctx.save();
                        const fontSize = canvas.width / 20; // Tamanho da fonte proporcional
                        ctx.font = `bold ${fontSize}px Arial`;
                        ctx.fillStyle = 'rgba(128, 128, 128, 0.3)';
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        
                        // Rotaciona e desenha a marca d'água
                        const centerX = canvas.width / 2;
                        const centerY = canvas.height / 2;
                        ctx.translate(centerX, centerY);
                        ctx.rotate(-0.5); // Rotação em radianos (aprox. -28 graus)
                        ctx.fillText(WATERMARK_TEXT, 0, 0);
                        
                        ctx.restore();
                    });

                    pageNumSpan.textContent = num;
                });
            };

            const onPrevPage = () => { if (pageNum > 1) { pageNum--; renderPage(pageNum); } };
            const onNextPage = () => { if (pageNum < pdfDoc.numPages) { pageNum++; renderPage(pageNum); } };
            const onZoomIn = () => { currentScale += 0.2; renderPage(pageNum); };
            const onZoomOut = () => { if (currentScale > 0.4) { currentScale -= 0.2; renderPage(pageNum); } };
            
            document.getElementById('prev-page').addEventListener('click', onPrevPage);
            document.getElementById('next-page').addEventListener('click', onNextPage);
            document.getElementById('zoom-in').addEventListener('click', onZoomIn);
            document.getElementById('zoom-out').addEventListener('click', onZoomOut);

            // Bloqueia clique direito e atalho de impressão
            document.addEventListener('contextmenu', event => event.preventDefault());
            document.addEventListener('keydown', e => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                    e.preventDefault();
                    alert("A impressão foi desativada para este documento.");
                }
            });

            pdfjsLib.getDocument(PDF_URL).promise.then(doc => {
                pdfDoc = doc;
                pageCountSpan.textContent = pdfDoc.numPages;
                renderPage(pageNum);
            });
        }
        
        // Inicia o processo pedindo a senha
        checkPassword();
    </script>
</body>
</html>
